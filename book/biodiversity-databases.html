<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Biodiversity Databases | PhylogatR</title>
  <meta name="description" content="" />
  <meta name="generator" content="bookdown 0.26.3 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Biodiversity Databases | PhylogatR" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Biodiversity Databases | PhylogatR" />
  
  
  

<meta name="author" content="Bryan Carstens, Sydney Decker, Anahi Espindola, Sarah Foltz, Abbi Green, Danielle Parsons, Tara Pelletier, Jordan Satler" />


<meta name="date" content="2022-08-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dna.html"/>
<link rel="next" href="population-genetics-and-conservation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Background</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#how-to-use-this-book"><i class="fa fa-check"></i><b>1.1</b> How to use this book</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#prerequisites-if-using-r"><i class="fa fa-check"></i><b>1.2</b> Prerequisites if using R</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#r-and-rstudio"><i class="fa fa-check"></i><b>1.2.1</b> R and RStudio</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#r-packages"><i class="fa fa-check"></i><b>1.2.2</b> R packages</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#data-in-the-biological-sciences"><i class="fa fa-check"></i><b>2.1</b> Data in the biological sciences</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#why-species"><i class="fa fa-check"></i><b>2.2</b> Why species?</a></li>
<li class="chapter" data-level="2.3" data-path="introduction.html"><a href="introduction.html#the-scientific-method"><i class="fa fa-check"></i><b>2.3</b> The Scientific Method</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="dna.html"><a href="dna.html"><i class="fa fa-check"></i><b>3</b> DNA</a>
<ul>
<li class="chapter" data-level="3.1" data-path="dna.html"><a href="dna.html#the-genetic-code"><i class="fa fa-check"></i><b>3.1</b> The genetic code</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="dna.html"><a href="dna.html#practice-translate-the-following-dna-sequence-into-amino-acids"><i class="fa fa-check"></i><b>3.1.1</b> Practice: Translate the following DNA sequence into amino acids</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="dna.html"><a href="dna.html#mutation"><i class="fa fa-check"></i><b>3.2</b> Mutation</a></li>
<li class="chapter" data-level="3.3" data-path="dna.html"><a href="dna.html#synonymous-versus-non-synonymous-genetic-variation"><i class="fa fa-check"></i><b>3.3</b> Synonymous versus non-synonymous genetic variation</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="dna.html"><a href="dna.html#practice-introduce-a-mutation"><i class="fa fa-check"></i><b>3.3.1</b> Practice: Introduce a mutation</a></li>
<li class="chapter" data-level="3.3.2" data-path="dna.html"><a href="dna.html#practice-introduce-an-insertion"><i class="fa fa-check"></i><b>3.3.2</b> Practice: Introduce an insertion</a></li>
<li class="chapter" data-level="3.3.3" data-path="dna.html"><a href="dna.html#practice-calculate-the-proportion-of-single-base-pair-mutations-that-are-synonymous"><i class="fa fa-check"></i><b>3.3.3</b> Practice: Calculate the proportion of single base pair mutations that are synonymous</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="dna.html"><a href="dna.html#probabilities-snps-and-genetic-variation"><i class="fa fa-check"></i><b>3.4</b> Probabilities, SNPs, and genetic variation</a></li>
<li class="chapter" data-level="3.5" data-path="dna.html"><a href="dna.html#modeling-sequence-variation"><i class="fa fa-check"></i><b>3.5</b> Modeling sequence variation</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="dna.html"><a href="dna.html#practice-estimate-base-pair-composition"><i class="fa fa-check"></i><b>3.5.1</b> Practice: Estimate base pair composition</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="dna.html"><a href="dna.html#organellar-genomes-and-barcoding-genes"><i class="fa fa-check"></i><b>3.6</b> Organellar genomes and barcoding genes</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="biodiversity-databases.html"><a href="biodiversity-databases.html"><i class="fa fa-check"></i><b>4</b> Biodiversity Databases</a>
<ul>
<li class="chapter" data-level="4.1" data-path="biodiversity-databases.html"><a href="biodiversity-databases.html#global-biodiversity-information-facility-gbif"><i class="fa fa-check"></i><b>4.1</b> Global Biodiversity Information Facility (GBIF)</a></li>
<li class="chapter" data-level="4.2" data-path="biodiversity-databases.html"><a href="biodiversity-databases.html#genbank"><i class="fa fa-check"></i><b>4.2</b> GenBank</a></li>
<li class="chapter" data-level="4.3" data-path="biodiversity-databases.html"><a href="biodiversity-databases.html#bold"><i class="fa fa-check"></i><b>4.3</b> BOLD</a></li>
<li class="chapter" data-level="4.4" data-path="biodiversity-databases.html"><a href="biodiversity-databases.html#phylogatr"><i class="fa fa-check"></i><b>4.4</b> <em>PhylogatR</em></a></li>
<li class="chapter" data-level="4.5" data-path="biodiversity-databases.html"><a href="biodiversity-databases.html#using-phylogatr"><i class="fa fa-check"></i><b>4.5</b> Using <em>phylogatR</em></a></li>
<li class="chapter" data-level="4.6" data-path="biodiversity-databases.html"><a href="biodiversity-databases.html#practice"><i class="fa fa-check"></i><b>4.6</b> Practice</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="biodiversity-databases.html"><a href="biodiversity-databases.html#downloading-data-from-phylogatr"><i class="fa fa-check"></i><b>4.6.1</b> Downloading data from <em>phylogatR</em></a></li>
<li class="chapter" data-level="4.6.2" data-path="biodiversity-databases.html"><a href="biodiversity-databases.html#check-for-outliers"><i class="fa fa-check"></i><b>4.6.2</b> Check for outliers</a></li>
<li class="chapter" data-level="4.6.3" data-path="biodiversity-databases.html"><a href="biodiversity-databases.html#check-sequence-alignments"><i class="fa fa-check"></i><b>4.6.3</b> Check sequence alignments</a></li>
<li class="chapter" data-level="4.6.4" data-path="biodiversity-databases.html"><a href="biodiversity-databases.html#visualizing-geographic-coordinates"><i class="fa fa-check"></i><b>4.6.4</b> Visualizing geographic coordinates</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="population-genetics-and-conservation.html"><a href="population-genetics-and-conservation.html"><i class="fa fa-check"></i><b>5</b> Population genetics and conservation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="population-genetics-and-conservation.html"><a href="population-genetics-and-conservation.html#loss-of-genetic-diversity"><i class="fa fa-check"></i><b>5.1</b> Loss of genetic diversity</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="population-genetics-and-conservation.html"><a href="population-genetics-and-conservation.html#small-population-size"><i class="fa fa-check"></i><b>5.1.1</b> Small population size</a></li>
<li class="chapter" data-level="5.1.2" data-path="population-genetics-and-conservation.html"><a href="population-genetics-and-conservation.html#genetic-drift"><i class="fa fa-check"></i><b>5.1.2</b> Genetic drift</a></li>
<li class="chapter" data-level="5.1.3" data-path="population-genetics-and-conservation.html"><a href="population-genetics-and-conservation.html#gene-flow"><i class="fa fa-check"></i><b>5.1.3</b> Gene flow</a></li>
<li class="chapter" data-level="5.1.4" data-path="population-genetics-and-conservation.html"><a href="population-genetics-and-conservation.html#inbreeding"><i class="fa fa-check"></i><b>5.1.4</b> Inbreeding</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="population-genetics-and-conservation.html"><a href="population-genetics-and-conservation.html#units-of-conservation"><i class="fa fa-check"></i><b>5.2</b> Units of conservation</a></li>
<li class="chapter" data-level="5.3" data-path="population-genetics-and-conservation.html"><a href="population-genetics-and-conservation.html#practice-1"><i class="fa fa-check"></i><b>5.3</b> Practice</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="population-genetics-and-conservation.html"><a href="population-genetics-and-conservation.html#learning-objectives-1"><i class="fa fa-check"></i><b>5.3.1</b> Learning objectives:</a></li>
<li class="chapter" data-level="5.3.2" data-path="population-genetics-and-conservation.html"><a href="population-genetics-and-conservation.html#data"><i class="fa fa-check"></i><b>5.3.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="population-genetics-and-conservation.html"><a href="population-genetics-and-conservation.html#click-and-play"><i class="fa fa-check"></i><b>5.4</b> Click and play!</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="species-limits.html"><a href="species-limits.html"><i class="fa fa-check"></i><b>6</b> Species limits</a>
<ul>
<li class="chapter" data-level="6.1" data-path="species-limits.html"><a href="species-limits.html#cryptic-genetic-diversity"><i class="fa fa-check"></i><b>6.1</b> Cryptic genetic diversity</a></li>
<li class="chapter" data-level="6.2" data-path="species-limits.html"><a href="species-limits.html#genetic-clustering"><i class="fa fa-check"></i><b>6.2</b> Genetic clustering</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="species-limits.html"><a href="species-limits.html#structure"><i class="fa fa-check"></i><b>6.2.1</b> Structure</a></li>
<li class="chapter" data-level="6.2.2" data-path="species-limits.html"><a href="species-limits.html#structurama"><i class="fa fa-check"></i><b>6.2.2</b> Structurama</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="species-limits.html"><a href="species-limits.html#tree-based-methods"><i class="fa fa-check"></i><b>6.3</b> Tree-based methods</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="species-limits.html"><a href="species-limits.html#general-mixed-yule-coalescent-gmyc"><i class="fa fa-check"></i><b>6.3.1</b> General mixed Yule Coalescent (GMYC)</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="species-limits.html"><a href="species-limits.html#practice-2"><i class="fa fa-check"></i><b>6.4</b> Practice</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="species-limits.html"><a href="species-limits.html#data-preparation"><i class="fa fa-check"></i><b>6.4.1</b> Data Preparation</a></li>
<li class="chapter" data-level="6.4.2" data-path="species-limits.html"><a href="species-limits.html#generate-a-phylogenetic-tree"><i class="fa fa-check"></i><b>6.4.2</b> Generate a Phylogenetic Tree</a></li>
<li class="chapter" data-level="6.4.3" data-path="species-limits.html"><a href="species-limits.html#create-a-summary-tree"><i class="fa fa-check"></i><b>6.4.3</b> Create a summary tree</a></li>
<li class="chapter" data-level="6.4.4" data-path="species-limits.html"><a href="species-limits.html#species-delimitation"><i class="fa fa-check"></i><b>6.4.4</b> Species Delimitation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="predictive-phylogeography.html"><a href="predictive-phylogeography.html"><i class="fa fa-check"></i><b>7</b> Predictive Phylogeography</a>
<ul>
<li class="chapter" data-level="7.0.1" data-path="predictive-phylogeography.html"><a href="predictive-phylogeography.html#trait-data-and-response-variables"><i class="fa fa-check"></i><b>7.0.1</b> Trait data and response variables</a></li>
<li class="chapter" data-level="7.1" data-path="predictive-phylogeography.html"><a href="predictive-phylogeography.html#machine-learning-and-random-forest"><i class="fa fa-check"></i><b>7.1</b> Machine learning and random forest</a></li>
<li class="chapter" data-level="7.2" data-path="predictive-phylogeography.html"><a href="predictive-phylogeography.html#real-life-example"><i class="fa fa-check"></i><b>7.2</b> Real life example</a></li>
<li class="chapter" data-level="7.3" data-path="predictive-phylogeography.html"><a href="predictive-phylogeography.html#practice-3"><i class="fa fa-check"></i><b>7.3</b> Practice</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i><b>8</b> References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./"><img src="Segoe1.png" title="fig:" style="width:75.0%" alt="PhylogatR" /></a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="biodiversity-databases" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Biodiversity Databases<a href="biodiversity-databases.html#biodiversity-databases" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>There are many open-source databases that house all types of biodiversity data, and we can use these data to study biodiversity in many different ways. This mostly includes information about what species are found where, but can also include additional information from an individual at a particular location, such as DNA sequence data, sex, body size, or even body condition. These databases are populated by researchers who deposit their data after completion of a research project. For example, researchers have spent many hours in the field searching for several species of <em>Plethodon</em> salamander in the Pacific Northwest of the United States. For every individual they find they record GPS coordinates (latitude and longitude), along with other information about the location and individual. Many researchers also collect a non-invasive tissue sample to sequence DNA for those individuals in order to gain an understanding of the genetic variation within each species. Once finished with a research project, these data are made publicly available by uploading the data to one of many repositories. We will focus on three main data repositories for this book that are used to feed our webserver that creates data-analysis-ready files.</p>
<p><img src="pleth4.jpg" style="width:100.0%" /></p>
  <p><font size="1"><em>For many organisms (like the Dunn's salamander, Plethodon dunni, shown above), researchers have collected various types of biodiversity data, including genetic sequences, geographic distribution, life history traits, and environmental information. This data is often made available on a biodiversity database, like those described below. </em></font></p>
<div id="global-biodiversity-information-facility-gbif" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Global Biodiversity Information Facility (GBIF)<a href="biodiversity-databases.html#global-biodiversity-information-facility-gbif" class="anchor-section" aria-label="Anchor link to header"></a></h2>

<p>The Global Biodiversity Information Facility <a href="https://www.gbif.org/" target="_blank">GBIF</a> was established in 2001 with the goal to make biodiversity data from specimen collections and observations accessible to anyone anywhere and promote scientific collaboration. It is an international network where members participate in housing computer nodes and making decisions as a collective. As of May 2022, GBIF houses over two billion occurrence records for over one million species, from over 60,000 datasets. While there are geographic biases in the data and not all described species are included (Yesson et al. 2007), this is a massive amount of data! These data have been used to study behavior, systematics, impacts of climate change, invasive species, conservation, and food security issues (see GBIF’s <a href="https://www.gbif.org/science-review" target="_blank">science review</a> for more details).</p>
<p><img src="gbif_final.jpg" style="width:100.0%" /></p>
  <p><font size="1"><em>The Global Biodiversity Information Facility (GBIF) contains billions of species occurrence records that can be accessed freely online. </em></font></p>
<p>In the example in the opening paragraph, one could supply GBIF with information for each individual salamander for which data was collected. GBIF uses Darwin Core data standards (Wieczorek et al. 2012) and will not accept data that do not comply with these standards. Information from several aspects are required in data submissions, for example, record (<em>e.g.</em>, nature of record, observer), event (<em>e.g.</em>, date), location (<em>e.g.</em>, GPS coordinates, locality descriptions), occurrence (<em>e.g.</em>, associated sequence or media data), and taxon (<em>e.g.</em>, scientific and common names). Each term has a specific definition in order to standardize the data that is included. When a researcher also generates DNA sequence data associated with the individuals, an identifier for that sequence for that individual that was deposited on a database that houses genetic data can be included.</p>
<p>Some problems that may be encountered when using this database are localities that are in a nearby water body for organisms that are known to be terrestrial, input errors where the sign is reversed for latitude or longitude, or latitude and longitude input as zero rather than identified as missing data. These can be rectified with some data cleaning steps we will discuss later in this chapter.</p>
</div>
<div id="genbank" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> GenBank<a href="biodiversity-databases.html#genbank" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The occurrence data provided by GBIF are used for many purposes in the biodiversity sciences however, associated sequence data from open-source repositories can allow us to ask even more exciting questions in biology! <a href="https://www.ncbi.nlm.nih.gov/genbank/" target="_blank">GenBank</a> is a collection of DNA sequence data from three organizations: DNA DataBank of Japan (DDBJ), the European Nucleotide Archive (ENA), and GenBank at NCBI (Benson et al. 2018). The goals of GenBank, released in 1982, are to provide access to and encourage use within the scientific community of the most up-to-date DNA sequence information. There are several ways to obtain these data and several types of DNA data that are stored. We will focus on the Nucleotide database. Once data are submitted and approved, all DNA sequences are assigned a unique identifier called an accession number. GenBank currently houses 218,642,238 sequences and 654,057,069,549 base pairs. Again, this is a massive amount of data!</p>
<p><img src="ncbi_final.jpg" style="width:100.0%" /></p>
  <p><font size="1"><em>The GenBank online portal allows users to search for and download genetic data from species around the world. </em></font></p>
<p>In the example in the opening paragraph, one would supply GenBank with each DNA sequence for each individual. These data may then be downloaded by other users in conjunction with DNA sequences from other studies and other species to answer all kinds of questions in ecology, evolution, and conservation, many of which we will explore throughout this book.</p>
<p>Some problems that may be encountered when using this database are misidentified species, changes in taxonomy after submission, poorly annotated sequences, and even some sequences that are parasites but are labeled as that species. These issues result in the inability to adequately align DNA sequences for downstream use. There are several steps that can be taken to minimize the amount of messy data, and these will be discussed later in this chapter.</p>
</div>
<div id="bold" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> BOLD<a href="biodiversity-databases.html#bold" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Biodiversity of Life Database (<a href="https://www.boldsystems.org/" target="_blank">BOLD</a>) was developed by the Center for Biodiversity Genomics in Canada and contains barcode data for almost 600,000 species from over 1.7 million records. Barcode data are DNA from a specific DNA locus used to identify individuals to species (see Chapter 6). This is often the mitochondrial gene <em>Cytochrome Oxidase I</em> (COI) for animals, the chloroplast genes <em>rubisco large subunit</em> (rbcl) or <em>maturase K</em> (matK) for plants, and the <em>Internal Transcriped Spacer</em> (ITS) for fungi. Data in this portal usually consists of geographic, taxonomic, and natural history collection information. Issues with this database are similar to those described above.</p>
<p><img src="bold_final.jpg" style="width:100.0%" /></p>
  <p><font size="1"><em>The Biodiversity of Life Database (BOLD) contains genetic barcode data as well as associated geographic, taxonomic, and natural history collection information from thousands of species. </em></font></p>
</div>
<div id="phylogatr" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> <em>PhylogatR</em><a href="biodiversity-databases.html#phylogatr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://phylogatr.org/" target="_blank"><em>Phylogatr</em></a> (phylogeographic data aggregation and repurposing) links occurrence data from GBIF and sequence data from GenBank so that DNA sequences can be traced to a specific geographic location and analysed in bulk. The data downloads from <em>phylogatr</em> are DNA sequence alignments (as discussed in Chapter 3) with associated GPS coordinates that are analysis ready. Computer scripts are provided throughout this book to assist data analysis and provide user-friendly teaching tools. Analysis of these data can be conducted on the Ohio Supercomputer using R scripts or R Shiny apps provided by the <em>phylogatr</em> team.</p>
<p><img src="figure1.png" />
<em>Phylogatr</em> first pulls down data from GBIF that includes a GenBank accession number and those that include GPS coordinates. Several other filters available from GBIF are implemented, for example, fossil specimens are not included. These sequences are then retrieved by <em>phylogatr</em> and sorted by species and locus. There has been some debate as to whether open-source data that is readily available are valuable due to the unreliability in the data (Causey et al. 2004; Wheeler et al. 2004). We argue that data processing and checking has greatly improved (Guralnick &amp; Hill 2009) and by carefully choosing data cleaning steps and practicing reproducibility standards, these data are invaluable in understanding patterns in biodiversity.</p>
<p>In order to overcome the problems that might be encountered in the databases discussed above, the following data cleaning steps are carried out. Duplicate entries are removed based on a sorting scheme that finds duplicate entries based on the same GenBank number, GBIF identifier, geographic coordinates, species name, and date of occurrence event. Gene names are then standardized to the best of our ability. Mitochondrial gene names were relatively easy to standardize because they are highly represented in GenBank and have an easily manageable number of genes. For example, the cytochrome oxidase b gene might be deposited on GenBank using any of the following abbreviations: Cytb, Cyt-b, COB. These types of issues are problematic for data science projects where we need to group things that are the same and separate things that are different. In this case we can standardize all cytochrome oxidase b sequences by calling them one name: cytb. This is a work in progress and as we learn more about genomics across the diversity of life, we will be able to standardize nuclear gene names more throroughly. Currently, in some instances you might have different gene abbreviations for the same gene across different organisms.</p>
<p>The last step that <em>phylogatr</em> takes is to align sequences that are from the same locus for the same species. We use the program <a href="https://mafft.cbrc.jp/alignment/software/" target="_blank">MAFFT v7</a> to align DNA sequences. During this process sequences are checked that they are going in the same direction. After this step, we need to check the alignments to make sure there are no really short or spurious sequences in the alignment. A bad alignment will vastly overestimate genetic distance among individuals in the alignment (see the last section of this chapter for an example of a bad alignment). We used <a href="http://trimal.cgenomics.org/downloads" target="_blank">TrimAI v1.2</a> to clean up the alignments automatically because there are too many to do this by eye. This step removes sequences that are really short (meaning there is a lot of missing data) so that any downstream analyses are not biased. Then it removes any sequences that do not overlap with the majority of sequences. This allows us to remove DNA sequences that have been labeled incorrectly. For more details on the <em>phylogatr</em> pipeline see the <a href="https://onlinelibrary.wiley.com/doi/10.1111/1755-0998.13673">publication</a> and/or <a href="https://github.com/OSC/phylogatr">GitHub page</a>.</p>
</div>
<div id="using-phylogatr" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Using <em>phylogatR</em><a href="biodiversity-databases.html#using-phylogatr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The first step in using <em>phylogatR</em> is to decide what geographic region you are interested in exploring. This can be done by specifying longitude and latitude or drawing a box around the region of interest. Skip this step if you want to download a global dataset. <em>Coming soon: clicking on continents or biogeographic regions</em></p>
<p><img src="choosegps.jpg" /></p>
<p>Then identify what taxonomic group you will focus on. In this example, we typed ‘caudata’ (a group of amphibians: salamanders) in the filter box, but you can also click on any names to keep those in your search. If you choose to type in a filter, you’ll want to check the search list because it will retain anything that has ‘caudata’ in the name. For example, see row two below (species: Monodelphis brevicaudata). It is an opossum, but the species name has ‘caudata’ nested within it. I only want salamanders, so I will click on ‘Caudata’ under order so everything else is removed. Skip this step if you want all species available.</p>
<p><img src="choosetaxon.jpg" /></p>
<p>The data can be downloaded as a zip file or a tarball, depending on your operating system. Your download will be called <code>phylogatr-results</code>. If you are using a Mac, the zip or tarball file will unzip when you double click on it. If you are using Windows, you must extract the zip file first (this is very important, otherwise the computer won’t recognize the file).The download includes a series of folders that are structured by taxonomy. The root folder will contain two files.</p>
<ol style="list-style-type: decimal">
<li><p>Tab delimited file called <code>genes.txt</code>. This file contains the gene and species for every alignment in the download, the directory in which the data are found, proportion of sequences retained after cleaning steps, number of unaligned sequences, number of aligned sequences, Kingdom, Phylum, Class, Order, Family, Genus, Species, Subspecies (when applicable), and a column to indicate whether the GBIF and Genbank species names do not match.</p></li>
<li><p>The <code>cite.txt</code> file contains the version numbers used for GBIF, GenBank, BOLD, and <em>phylogatR</em>.</p></li>
</ol>
<p>The highest level of taxonomy that will have its own folder is Class. Then a series of folders will be nested within each of these folders, until you get to species. Each species folder will contain the following files:</p>
<ol start="3" style="list-style-type: decimal">
<li><p>Fasta file with all the unaligned sequences for each locus with the file extension <code>.fa</code></p></li>
<li><p>Fasta file with the aligned sequences for each locus with the file extension <code>.afa</code></p></li>
<li><p>Tab-delimited file with data for each individual in the sequence alignment called <code>occurrence.txt</code>. This file contains the GenBank accession, GBIF ID, latitude, longitude, basis of record, geodetic datum, coordinate uncertainty, and identified issues.</p></li>
</ol>
</div>
<div id="practice" class="section level2 hasAnchor" number="4.6">
<h2><span class="header-section-number">4.6</span> Practice<a href="biodiversity-databases.html#practice" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This module is designed to explore data downloads from <em>phylogatR</em> for observations that look spurious. Data cleaning, and filtering out bad data, is the most important step in a data science project. Bad data = bad results. The code presented here pulls genetic and geographic data downloaded from the <em>phylogatR</em> website and allows you to create a list of sequence alignments that stand out in the data based on estimates of nucleotide diversity. You will then visualize sequence alignments for individual loci simultaneously so that you may check them by eye, and plot geographic coordinates of occurrences on a map for visual inspection.</p>
<div id="learning-objectives" class="section level4 hasAnchor" number="4.6.0.1">
<h4><span class="header-section-number">4.6.0.1</span> Learning objectives<a href="biodiversity-databases.html#learning-objectives" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li>Navigate an open-source database.</li>
<li>Explain why data cleaning is a necessary step in data analysis.</li>
<li>Quantify outliers from data.</li>
<li>Identify poorly aligned sequence data.</li>
<li>Identify geographic outliers.</li>
</ol>
</div>
<div id="downloading-data-from-phylogatr" class="section level3 hasAnchor" number="4.6.1">
<h3><span class="header-section-number">4.6.1</span> Downloading data from <em>phylogatR</em><a href="biodiversity-databases.html#downloading-data-from-phylogatr" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><em>PhylogatR</em> is a database that supplies users with DNA sequence data from thousands of species that are ready to analyze. There are several steps that needs to be carried out before DNA sequences can be used for data analysis.</p>
<ol style="list-style-type: decimal">
<li>Choose a taxonomic group to assess sequence alignments and geographic coordinates.</li>
<li>Navigate to the <a href="https://phylogatr.org/" target="_blank" rel="noopener"><em>phylogatR</em></a> website to download data.</li>
</ol>
<p>In the example below, <code>fungi</code> was typed into the filter box, but you can also click on any names to keep those in your search. If you choose to type in a filter term, you will want to check the search list because it will retain anything that has <code>fungi</code> in the name. For example, see row two below (Family: Fungiidae). It is a coral, which is an animal, but the Family name has <code>fungi</code> nested within it. If you only want <code>fungi</code>, you will need to click on <code>fungi</code> under Kingdom so everything else is removed. For practice, choose a group that doesn’t contain too many species (&lt;100 species).
<img src="p.png" alt="p" /></p>
<p>Your download will be a zip file called <code>phylogatr-results</code>. If you are using a Mac, the zip file will unzip when you double click on it. If you are using Windows, you must extract the files first (this is very important, otherwise the computer won’t recognize the file).</p>
<div id="pro-tip-stay-organized.-make-sure-all-the-files-you-want-to-access-are-in-the-same-folder-or-someplace-you-know-where-to-tell-r-to-find-them.-if-you-do-not-do-this-r-will-not-be-able-to-find-your-files-later-for-import.-put-the-phylogatr-results-folder-somewhere-you-can-easily-find-it." class="section level4 hasAnchor" number="4.6.1.1">
<h4><span class="header-section-number">4.6.1.1</span> <strong>Pro Tip</strong>: Stay organized. Make sure all the files you want to access are in the same folder, or someplace you know where to tell R to find them. If you do not do this, R will not be able to find your files later for import. Put the <code>phylogatr-results</code> folder somewhere you can easily find it.<a href="biodiversity-databases.html#pro-tip-stay-organized.-make-sure-all-the-files-you-want-to-access-are-in-the-same-folder-or-someplace-you-know-where-to-tell-r-to-find-them.-if-you-do-not-do-this-r-will-not-be-able-to-find-your-files-later-for-import.-put-the-phylogatr-results-folder-somewhere-you-can-easily-find-it." class="anchor-section" aria-label="Anchor link to header"></a></h4>
</div>
</div>
<div id="check-for-outliers" class="section level3 hasAnchor" number="4.6.2">
<h3><span class="header-section-number">4.6.2</span> Check for outliers<a href="biodiversity-databases.html#check-for-outliers" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This section will take you through the process of estimating nucleotide diversity in a group of closely related species and determine which estimates fall outside of the 95% range of values for this summary statistic.</p>
<p>You will need to load R packages in order to obtain the functions necessary for the analyses that will be conducted. If you have not already installed these packages, you will need to do that first. See <a href="https://www.neonscience.org/packages-in-r" target="_blank" rel="noopener">here</a> for more information on package installation in R. You will need to install the following packages using the <code>install.packages()</code> function. You only need to install packages once on your computer, but you need to load the library every time you open a new R session.</p>
<p>For example, copy and paste <code>install.packages("tools")</code> into the console in RStudio (bottom left). Do the same thing for each package that needs to be installed for each of the required packages listed below.</p>
<ul>
<li>adegenet</li>
<li>ape</li>
<li>apex</li>
<li>ggplot2</li>
<li>maps</li>
<li>pegas</li>
<li>phangorn</li>
<li>seqinr</li>
<li>tools</li>
</ul>
<blockquote>
<h2 id="r-package-issues" class="hasAnchor">R package issues<a href="biodiversity-databases.html#r-package-issues" class="anchor-section" aria-label="Anchor link to header"></a></h2>
If you are still having issues with installing these packages you can use RStudio to update R using the following code. You will need to reinstall any packages that have already been installed before you took this step.
For Windows:
<style type="text/css">
.indent {
margin-left: 30px;
}
</style>
</blockquote>
<div class="sourceCode" id="cb1"><pre class="sourceCode r indent"><code class="sourceCode r"><span id="cb1-1"><a href="biodiversity-databases.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;installr&quot;</span>)</span>
<span id="cb1-2"><a href="biodiversity-databases.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(installr)</span>
<span id="cb1-3"><a href="biodiversity-databases.html#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">updateR</span>()</span></code></pre></div>
<blockquote>
<p>If you are using a Mac, you can go <a href="https://cloud.r-project.org/bin/macosx/" target="_blank">here</a> and install the newest version on your computer. Restart RStudio and the latest verion of R should be running.</p>
</blockquote>
<p>Next, load all the packages necessary for this exercise.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="biodiversity-databases.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load necessary packages</span></span>
<span id="cb2-2"><a href="biodiversity-databases.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(adegenet)</span>
<span id="cb2-3"><a href="biodiversity-databases.html#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ape)</span>
<span id="cb2-4"><a href="biodiversity-databases.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(apex)</span>
<span id="cb2-5"><a href="biodiversity-databases.html#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-6"><a href="biodiversity-databases.html#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(maps)</span>
<span id="cb2-7"><a href="biodiversity-databases.html#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pegas)</span>
<span id="cb2-8"><a href="biodiversity-databases.html#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(phangorn)</span>
<span id="cb2-9"><a href="biodiversity-databases.html#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(seqinr)</span>
<span id="cb2-10"><a href="biodiversity-databases.html#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tools)</span></code></pre></div>
<p>You can ignore messages that might pop up when loading these libraries, unless it is telling you that it is not available, then see above.</p>
<div id="explore-data" class="section level4 hasAnchor" number="4.6.2.1">
<h4><span class="header-section-number">4.6.2.1</span> Explore data<a href="biodiversity-databases.html#explore-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>When importing your own data from <em>phylogatR</em>, you will need to change the file path or set your current working directory accordingly. When you import your own data from <em>phylogatR</em>, you might need to change the code below to the correct path. Read more about file paths <a href="https://ssc.wisc.edu/sscc/pubs/R_intro/book/1-10-paths-and-working-directories.html" target="_blank">here</a>.</p>
<p>We are going to explore a small set of mammal data for demonstration purposes. In this case, our current working directory contains the <code>phylogatr-data</code> folder.</p>
<p>Import the <code>genes.txt</code> file to extract information from the download.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="biodiversity-databases.html#cb3-1" aria-hidden="true" tabindex="-1"></a>genes <span class="ot">&lt;-</span> <span class="fu">read.delim</span>(<span class="st">&quot;phylogatr-results/genes.txt&quot;</span>)</span>
<span id="cb3-2"><a href="biodiversity-databases.html#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="biodiversity-databases.html#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(genes)</span></code></pre></div>
<pre><code>## [1] 62</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="biodiversity-databases.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(genes<span class="sc">$</span>species)</span></code></pre></div>
<pre><code>##  [1] &quot;Anourosorex squamipes&quot;      &quot;Blarina brevicauda&quot;        
##  [3] &quot;Chimarrogale platycephalus&quot; &quot;Condylura cristata&quot;        
##  [5] &quot;Crocidura dsinezumi&quot;        &quot;Crocidura macmillani&quot;      
##  [7] &quot;Crocidura olivieri&quot;         &quot;Crocidura suaveolens&quot;      
##  [9] &quot;Crocidura tanakae&quot;          &quot;Crocidura wuchihensis&quot;     
## [11] &quot;Cryptotis lacertosus&quot;       &quot;Cryptotis magna&quot;           
## [13] &quot;Cryptotis mam&quot;              &quot;Cryptotis merriami&quot;        
## [15] &quot;Cryptotis mexicana&quot;         &quot;Cryptotis oreoryctes&quot;      
## [17] &quot;Neomys fodiens&quot;             &quot;Sorex araneus&quot;             
## [19] &quot;Sorex arcticus&quot;             &quot;Sorex bedfordiae&quot;          
## [21] &quot;Sorex caecutiens&quot;           &quot;Sorex cinereus&quot;            
## [23] &quot;Sorex daphaenodon&quot;          &quot;Sorex fumeus&quot;              
## [25] &quot;Sorex haydeni&quot;              &quot;Sorex hoyi&quot;                
## [27] &quot;Sorex isodon&quot;               &quot;Sorex longirostris&quot;        
## [29] &quot;Sorex minutissimus&quot;         &quot;Sorex minutus&quot;             
## [31] &quot;Sorex monticolus&quot;           &quot;Sorex palustris&quot;           
## [33] &quot;Sorex roboratus&quot;            &quot;Sorex trowbridgii&quot;         
## [35] &quot;Sorex tundrensis&quot;           &quot;Sorex vagrans&quot;             
## [37] &quot;Sorex volnuchini&quot;</code></pre>
<p>The<code>nrows()</code> function counts how many rows are in your dataset.</p>
</div>
<div id="import-sequence-data" class="section level4 hasAnchor" number="4.6.2.2">
<h4><span class="header-section-number">4.6.2.2</span> Import sequence data<a href="biodiversity-databases.html#import-sequence-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, we are going to create a list of all the sequence alignments and put them in an object called <code>myfiles</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="biodiversity-databases.html#cb7-1" aria-hidden="true" tabindex="-1"></a>myfiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">&quot;phylogatr-results&quot;</span>, <span class="at">pattern =</span> <span class="st">&quot;.afa&quot;</span>, <span class="at">full.names=</span><span class="cn">TRUE</span>, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
</div>
<div id="calculate-genetic-diversity" class="section level4 hasAnchor" number="4.6.2.3">
<h4><span class="header-section-number">4.6.2.3</span> Calculate genetic diversity<a href="biodiversity-databases.html#calculate-genetic-diversity" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Here we loop through the list stored in <code>myfiles</code> to calculate genetic diversity for each sequence alignment. All data will be written to a csv file called <code>phylogatr-pi.csv</code> and stored at the path specified at the end of the loop. Here, we are storing the file on my desktop, but you will need to change the path to where you want the file stored accordingly.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="biodiversity-databases.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (f <span class="cf">in</span> myfiles) {</span>
<span id="cb8-2"><a href="biodiversity-databases.html#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="biodiversity-databases.html#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#get species and gene name</span></span>
<span id="cb8-4"><a href="biodiversity-databases.html#cb8-4" aria-hidden="true" tabindex="-1"></a>  sp <span class="ot">&lt;-</span> <span class="fu">basename</span>(f)</span>
<span id="cb8-5"><a href="biodiversity-databases.html#cb8-5" aria-hidden="true" tabindex="-1"></a>  sp <span class="ot">&lt;-</span> <span class="fu">file_path_sans_ext</span>(sp)</span>
<span id="cb8-6"><a href="biodiversity-databases.html#cb8-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-7"><a href="biodiversity-databases.html#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#read in fasta file</span></span>
<span id="cb8-8"><a href="biodiversity-databases.html#cb8-8" aria-hidden="true" tabindex="-1"></a>  seq <span class="ot">&lt;-</span> <span class="fu">fasta2DNAbin</span>(f, <span class="at">quiet=</span><span class="cn">TRUE</span>)</span>
<span id="cb8-9"><a href="biodiversity-databases.html#cb8-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-10"><a href="biodiversity-databases.html#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="co">#get number of sequences</span></span>
<span id="cb8-11"><a href="biodiversity-databases.html#cb8-11" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(seq)</span>
<span id="cb8-12"><a href="biodiversity-databases.html#cb8-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-13"><a href="biodiversity-databases.html#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="co">#calculate nucleotide diversity</span></span>
<span id="cb8-14"><a href="biodiversity-databases.html#cb8-14" aria-hidden="true" tabindex="-1"></a>  pi <span class="ot">&lt;-</span> <span class="fu">nuc.div</span>(seq)</span>
<span id="cb8-15"><a href="biodiversity-databases.html#cb8-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-16"><a href="biodiversity-databases.html#cb8-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-17"><a href="biodiversity-databases.html#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="co">#write data to file</span></span>
<span id="cb8-18"><a href="biodiversity-databases.html#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write.table</span>(<span class="fu">data.frame</span>(sp, pi, n), <span class="at">file=</span><span class="st">&quot;phylogatr-pi.csv&quot;</span>, <span class="at">quote=</span><span class="cn">FALSE</span>, <span class="at">row.names=</span><span class="cn">FALSE</span>, <span class="at">col.names=</span><span class="sc">!</span><span class="fu">file.exists</span>(<span class="st">&quot;phylogatr-pi.csv&quot;</span>), <span class="at">append=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>)</span>
<span id="cb8-19"><a href="biodiversity-databases.html#cb8-19" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>You will see the error <code>wrong file extension</code>. This can be ignored. It is because we are using <em>.fa</em> and <em>.fas</em> as our file extensions instead of the expected <em>.fasta</em>.</p>
</div>
<div id="outlier-analysis" class="section level4 hasAnchor" number="4.6.2.4">
<h4><span class="header-section-number">4.6.2.4</span> Outlier analysis<a href="biodiversity-databases.html#outlier-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First, import the output from the previous step. If necessary, change the path to the file accordingly.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="biodiversity-databases.html#cb9-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;phylogatr-pi.csv&quot;</span>)</span></code></pre></div>
<p>Print out a list of sequence alignments that fall outside the 95th percentile of the distribution. These may contain poor sequence alignments, though we do recommend checking those that are deemed suspicious by eye. For more information on screening for outliers please see <a href="https://statsandr.com/blog/outliers-detection-in-r" target="_blank">here</a>.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="biodiversity-databases.html#cb10-1" aria-hidden="true" tabindex="-1"></a>lower_bound <span class="ot">&lt;-</span> <span class="fu">quantile</span>(data<span class="sc">$</span>pi, <span class="fl">0.025</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb10-2"><a href="biodiversity-databases.html#cb10-2" aria-hidden="true" tabindex="-1"></a>lower_bound</span></code></pre></div>
<pre><code>## 2.5% 
##    0</code></pre>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="biodiversity-databases.html#cb12-1" aria-hidden="true" tabindex="-1"></a>upper_bound <span class="ot">&lt;-</span> <span class="fu">quantile</span>(data<span class="sc">$</span>pi, <span class="fl">0.975</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb12-2"><a href="biodiversity-databases.html#cb12-2" aria-hidden="true" tabindex="-1"></a>upper_bound</span></code></pre></div>
<pre><code>##      97.5% 
## 0.05139108</code></pre>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="biodiversity-databases.html#cb14-1" aria-hidden="true" tabindex="-1"></a>outliers <span class="ot">&lt;-</span> <span class="fu">which</span>(data<span class="sc">$</span>pi <span class="sc">&lt;</span> lower_bound <span class="sc">|</span> data<span class="sc">$</span>pi <span class="sc">&gt;</span> upper_bound)</span>
<span id="cb14-2"><a href="biodiversity-databases.html#cb14-2" aria-hidden="true" tabindex="-1"></a>data[outliers,]</span></code></pre></div>
<pre><code>##                          sp         pi n
## 11 Crocidura-suaveolens-COI 0.08494409 7
## 24   Cryptotis-mexicana-COI 0.05503145 3</code></pre>
<p>You might notice that we included a <code>na.rm = T</code> command in the <code>quantile</code> function. This removes any entries that had an <code>NA</code> value as output for the estimate of nucleotide diveristy. Sometimes this happens when something is wrong with the alignment. We can list those here as well to check.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="biodiversity-databases.html#cb16-1" aria-hidden="true" tabindex="-1"></a>nas <span class="ot">&lt;-</span> <span class="fu">which</span>(data<span class="sc">$</span>pi <span class="sc">==</span> <span class="cn">NA</span>)</span>
<span id="cb16-2"><a href="biodiversity-databases.html#cb16-2" aria-hidden="true" tabindex="-1"></a>nas  </span></code></pre></div>
<pre><code>## integer(0)</code></pre>
<p>In this case, we did not have any alignments that produced NA values so our object is empty.</p>
</div>
</div>
<div id="check-sequence-alignments" class="section level3 hasAnchor" number="4.6.3">
<h3><span class="header-section-number">4.6.3</span> Check sequence alignments<a href="biodiversity-databases.html#check-sequence-alignments" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We are going to look at the data from the species <em>Sorex monticolus</em>, the Montane shrew, in more detail.</p>
<p>First, we need to store the path names of all of the aligned fasta files for our chosen species. <strong>Make sure your path is set to the folder of the species that you want to inspect.</strong> We will generate a list of paths to all of the aligned fasta files (i.e., all files in the species folder that end in .afa) using the function <code>list.files</code> and store this list in R as <code>myfiles</code>. This is similar to what we did above, but we are listing those from a different folder. Notice that we have overwritten the myfiles R object with with a new list.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="biodiversity-databases.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#get paths to aligned fasta files in species folder (all .afa files in downloaded phylogatR folder)</span></span>
<span id="cb18-2"><a href="biodiversity-databases.html#cb18-2" aria-hidden="true" tabindex="-1"></a>myfiles<span class="ot">&lt;-</span><span class="fu">list.files</span>(<span class="at">path=</span><span class="st">&quot;phylogatr-results/Mammalia/Soricomorpha/Soricidae/Sorex-monticolus&quot;</span>, <span class="at">pattern=</span><span class="st">&quot;.afa&quot;</span>, <span class="at">full.names=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>Next, we will use the paths stored in <code>myfiles</code> to import our aligned fasta files and create a multidna object. A multidna object is a class of object used to store multiple DNA sequence alignments. Sequences are stored as a list, with each element of the list being a separate DNA alignment stored as a DNAbin matrix. For more information on DNAbin and multidna objects, see <a href="https://cran.r-project.org/web/packages/apex/apex.pdf" target="_blank" rel="noopener">here</a>.</p>
<p>We will use the function <code>read.multiFASTA</code> to create a multidna object containing our aligned fasta files. In the likely case that some individuals are not sequenced for all loci, setting the argument <code>add.gaps</code> to FALSE will ensure that indivuals that do not have a sequence for a locus (gap only sequences) will not be added to the alignment.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="biodiversity-databases.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">#create S4 class multidna object (contains DNAbin objects for all loci/.afa alignment files)</span></span>
<span id="cb19-2"><a href="biodiversity-databases.html#cb19-2" aria-hidden="true" tabindex="-1"></a>multidna<span class="ot">&lt;-</span><span class="fu">read.multiFASTA</span>(<span class="at">files=</span>myfiles, <span class="at">add.gaps=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p>Now we will use the <code>plot</code> function to visualize the separate alignments (<em>i.e.</em>, loci) in our multidna object simultaneously. When set to FALSE, the argument <code>rows</code> will return each locus in a separate image. If set to true, all loci will be shown in a single image (note: depending on how many alignments you have, setting <code>rows=TRUE</code> may make your alignments too small to inspect).</p>
<p>The resulting alignments will consist of a series of rows (each representing the DNA sequence of one individual) and columns (each representing a particular nucleotide position in the locus). Accession numbers for each individual are located to the left of each row and the species and gene/locus name are located at the bottom of the alignment. Nucleotides are color coded according to the legend located at the top of the alignment. These plots are for the <em>Sorex monticolus</em> data. Your plots should look something like this.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="biodiversity-databases.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#visualize the separate alignments in your multidna object simultaneously</span></span>
<span id="cb20-2"><a href="biodiversity-databases.html#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(multidna, <span class="at">rows=</span><span class="cn">FALSE</span>, <span class="at">ask=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="images/title-alignments-1.png" width="672" /><img src="images/title-alignments-2.png" width="672" /><img src="images/title-alignments-3.png" width="672" /><img src="images/title-alignments-4.png" width="672" /></p>
<p>Use the following code to export your alignments as a pdf. They will be exported as <code>sequences.pdf</code> into your current working directory, unless you change the file path.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="biodiversity-databases.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co">#export sequence alignments</span></span>
<span id="cb21-2"><a href="biodiversity-databases.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pdf</span>(<span class="at">file=</span><span class="st">&quot;sequences.pdf&quot;</span>)</span>
<span id="cb21-3"><a href="biodiversity-databases.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(multidna, <span class="at">rows=</span><span class="cn">FALSE</span>, <span class="at">ask=</span><span class="cn">FALSE</span>)</span>
<span id="cb21-4"><a href="biodiversity-databases.html#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dev.off</span>()</span></code></pre></div>
<blockquote>
<h2 id="sequence-alignments-what-to-watch-out-for" class="hasAnchor">Sequence alignments: what to watch out for<a href="biodiversity-databases.html#sequence-alignments-what-to-watch-out-for" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following alignments are meant to show you potential errors you might run into when inspecting your sequence alignments. <em>PhylogatR</em> takes steps to minimize these issues (see <a href="https://phylogatr.org" target="_blank" rel="noopener">here</a>), but it never hurts to check your data.</p>
</blockquote>
<p>In the first example, we have edited the alignment to contain sequences that have been entered in reverse (rev1-4) and reverse complement (revcompl1-2). As you can see, these sequences are comparable in length to the rest of the alignment and are lacking large regions of gaps. However, upon visual inspection they clearly do not line up with the rest of the alignment. These sequences can be checked and edited manually in a sequence viewing program (<em>e.g.</em>, <a href="http://ugene.net" target="_blank" rel="noopener">UGENE</a> or <a href="http://www.mesquiteproject.org/?BasicMesquiteOperationPanel=open" target="_blank" rel="noopener">mesquite</a>).
<img src="Rplot.png" /></p>
<p>In this example, we have added parasitic sequences (parasite1-3) to the alignment. These sequences contain long regions of gaps and the regions of nucleotides present do not line up with the rest of the alignment. If your alignment has questionable sequences such as these, you can do a search of their accession numbers <a href="https://www.ncbi.nlm.nih.gov" target="_blank" rel="noopener">here</a> to ensure they are from the correct species and locus.<br />
<img src="Rplot01.png" /></p>
<p><strong>If needed, you can submit corrections to GenBank sequence data by sending an error report to <a href="update@ncbi.nlm.nih.gov">update@ncbi.nlm.nih.gov</a>.</strong></p>
</div>
<div id="visualizing-geographic-coordinates" class="section level3 hasAnchor" number="4.6.4">
<h3><span class="header-section-number">4.6.4</span> Visualizing geographic coordinates<a href="biodiversity-databases.html#visualizing-geographic-coordinates" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Now we will use the <code>occurrences.txt</code> file located in the species folder of our <em>phylogatR</em> download to plot geographic coordinates for all individuals within our species folder and check for potential errors. First, we will import our <code>occurrences.txt</code> file, found in our species folder, into R and save it as a data frame called <code>occurrences</code>.</p>
<p>Once that data file has been imported into R, we will extract just the columns containing latitude and longitude (i.e., columns 4 and 5) and save them in R as an object <code>geo</code>.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="biodiversity-databases.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#read in geographic coordinates</span></span>
<span id="cb22-2"><a href="biodiversity-databases.html#cb22-2" aria-hidden="true" tabindex="-1"></a>occurrences<span class="ot">&lt;-</span><span class="fu">as.data.frame</span>(<span class="fu">read.table</span>(<span class="st">&quot;phylogatr-results/Mammalia/Soricomorpha/Soricidae/Sorex-monticolus/occurrences.txt&quot;</span>, <span class="at">header=</span><span class="cn">TRUE</span>, <span class="at">sep=</span><span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>))</span>
<span id="cb22-3"><a href="biodiversity-databases.html#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#extract latitude and longitude</span></span>
<span id="cb22-4"><a href="biodiversity-databases.html#cb22-4" aria-hidden="true" tabindex="-1"></a>geo<span class="ot">&lt;-</span>occurrences[,<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>)]</span></code></pre></div>
<p>Now we will plot our geographic coordinates on a map to inspect for errors. In the resulting map, each red dot represents a single sampling locality. Please keep in mind that when using geographic coordinates in R, longitude (the x-axis) comes first, and latitude (the y-axis) comes second.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="biodiversity-databases.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co">#plot localities</span></span>
<span id="cb23-2"><a href="biodiversity-databases.html#cb23-2" aria-hidden="true" tabindex="-1"></a>world<span class="ot">&lt;-</span><span class="fu">map_data</span>(<span class="st">&quot;world&quot;</span>)</span>
<span id="cb23-3"><a href="biodiversity-databases.html#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span> </span>
<span id="cb23-4"><a href="biodiversity-databases.html#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_polygon</span>(<span class="at">data =</span> world, <span class="fu">aes</span>(<span class="at">x=</span>long, <span class="at">y =</span> lat, <span class="at">group =</span> group), <span class="at">fill =</span> <span class="st">&quot;lightgrey&quot;</span>, <span class="at">color =</span> <span class="st">&quot;gray30&quot;</span>, <span class="at">size =</span> .<span class="dv">25</span>)<span class="sc">+</span></span>
<span id="cb23-5"><a href="biodiversity-databases.html#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_fixed</span>(<span class="fl">1.3</span>)<span class="sc">+</span></span>
<span id="cb23-6"><a href="biodiversity-databases.html#cb23-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Longitude&quot;</span>)<span class="sc">+</span></span>
<span id="cb23-7"><a href="biodiversity-databases.html#cb23-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Latitude&quot;</span>)<span class="sc">+</span></span>
<span id="cb23-8"><a href="biodiversity-databases.html#cb23-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Collection Locality Geographic Coordinates&quot;</span>)<span class="sc">+</span></span>
<span id="cb23-9"><a href="biodiversity-databases.html#cb23-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> geo, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.numeric</span>(geo<span class="sc">$</span>longitude), <span class="at">y =</span> <span class="fu">as.numeric</span>(geo<span class="sc">$</span>latitude)), <span class="at">color =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="fl">0.8</span>)</span></code></pre></div>
<p><img src="images/unnamed-chunk-13-1.png" width="672" /></p>
<blockquote>
<h2 id="geographic-coordinates-what-to-watch-out-for" class="hasAnchor">Geographic coordinates: what to watch out for<a href="biodiversity-databases.html#geographic-coordinates-what-to-watch-out-for" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The following map is meant to show you potential errors you might encounter when inspecting your geographic data.
You’ll want to look out for any data points that are obviously outside of your species expected range. Data points that are very far away from the rest of the points (<em>i.e.</em>, outliers) as well as data points in areas physiologically unlikely for your species (<em>e.g.</em>, a terrestrial shrew in the middle of the ocean) should warrant further inspection. If you are unsure of the extent of your species range, you can search for your species <a href="https://www.iucnredlist.org" target="_blank" rel="noopener">here</a>.</p>
</blockquote>
<p><img src="Rplot02.png" /></p>
<p><strong>If needed, you can submit corrections to GBIF occurrence data by clicking the speech bubble icon in the upper right corner of the <a href="https://www.gbif.org">GBIF website</a>.</strong></p>
<p>To summarize, it is always a good idea to check your data before you begin your data analysis steps. The <em>phylogatR</em> <a href="https://phylogatr.org/teacher_resources.html">teacher resources page</a> has additional R code that explores these issues in more detail.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dna.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="population-genetics-and-conservation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
